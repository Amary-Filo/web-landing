<div
  class="ngp-combobox"
  [class.ngp-combobox--open]="open()"
  [class.ngp-combobox--disabled]="isDisabled()"
  [ngpComboboxValue]="value()"
  [ngpComboboxDisabled]="isDisabled()"
  [ngpComboboxAllowDeselect]="clearable()"
  [ngpComboboxCompareWith]="compareFn()"
  (ngpComboboxValueChange)="onPrimitiveChange($event)"
  (ngpComboboxOpenChange)="onOpenChange($event)"
  (focusout)="handleBlur()"
  ngpCombobox
>
  <input
    class="ngp-combobox__input"
    ngpComboboxInput
    [value]="inputDisplay()"
    [placeholder]="placeholder()"
    [readonly]="!searchable()"
    (input)="onInput($event)"
  />

  @if (clearable() && currentSelected()) {
    <button
      type="button"
      class="ngp-combobox__clear"
      (click)="onClear($event)"
      aria-label="Очистить"
    >
      ✕
    </button>
  }

  <button
    ngpComboboxButton
    type="button"
    class="ngp-combobox__toggle"
    aria-label="Переключить список"
  >
    <span class="ngp-combobox__chevron" aria-hidden="true"></span>
  </button>

  <div *ngpComboboxPortal ngpComboboxDropdown class="ngp-combobox__dropdown">
    @if (hasGroups()) {
      @for (group of filteredGroups(); track group.label) {
        <div class="ngp-combobox__group">
          <div class="ngp-combobox__group-label">
            {{ group.label }}
            @if (group.description) {
              <span class="ngp-combobox__group-description">{{ group.description }}</span>
            }
          </div>

          @for (option of group.options; track option.value ?? option.label) {
            <div
              class="ngp-combobox__option"
              [class.ngp-combobox__option--with-hint]="option.hint"
              [ngpComboboxOptionValue]="option.value"
              [ngpComboboxOptionDisabled]="option.disabled"
              ngpComboboxOption
            >
              <span class="ngp-combobox__option-label">{{ option.label }}</span>
              @if (option.hint) {
                <span class="ngp-combobox__option-hint">{{ option.hint }}</span>
              }
            </div>
          }
        </div>
      }

      @if (!filteredGroups().length) {
        <div class="ngp-combobox__empty">Ничего не найдено</div>
      }
    } @else {
      @for (option of filteredOptions(); track option.value ?? option.label) {
        <div
          class="ngp-combobox__option"
          [class.ngp-combobox__option--with-hint]="option.hint"
          [ngpComboboxOptionValue]="option.value"
          [ngpComboboxOptionDisabled]="option.disabled"
          ngpComboboxOption
        >
          <span class="ngp-combobox__option-label">{{ option.label }}</span>
          @if (option.hint) {
            <span class="ngp-combobox__option-hint">{{ option.hint }}</span>
          }
        </div>
      }

      @if (!filteredOptions().length) {
        <div class="ngp-combobox__empty">Ничего не найдено</div>
      }
    }
  </div>
</div>
